<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js?1"></script>
    <title>Document</title>
</head>
<body>
    <pre><code id="webview_data"></code></pre>
    <button id="sendMessageButton">Send Message</button>
    <div id="btn_status"></div>
    <div id="theme_data"></div> <!-- Add this element -->
    <div id="webview_data_status"></div> <!-- Add this element -->

    <script type="text/javascript">
        const DemoApp = {
            initData: Telegram.WebApp.initData || '',
            initDataUnsafe: Telegram.WebApp.initDataUnsafe || {},
            MainButton: Telegram.WebApp.MainButton,

            init(options) {
                document.body.style.visibility = '';
                Telegram.WebApp.ready();
                Telegram.WebApp.MainButton.setParams({
                    text: 'CLOSE WEBVIEW',
                    is_visible: true
                }).onClick(DemoApp.close);
            },
            expand() {
                Telegram.WebApp.expand();
            },
            close() {
                Telegram.WebApp.close();
            },
            toggleMainButton(el) {
                const mainButton = Telegram.WebApp.MainButton;
                if (mainButton.isVisible) {
                    mainButton.hide();
                    el.innerHTML = 'Show Main Button';
                } else {
                    mainButton.show();
                    el.innerHTML = 'Hide Main Button';
                }
            },
            checkInitData() { // Define checkInitData here
                const webViewStatus = document.querySelector('#webview_data_status');
                if (DemoApp.initDataUnsafe.query_id &&
                    DemoApp.initData &&
                    webViewStatus.classList.contains('status_need')
                ) {
                    webViewStatus.classList.remove('status_need');
                    DemoApp.apiRequest('checkInitData', {}, function(result) {
                        if (result.ok) {
                            webViewStatus.textContent = 'Hash is correct (async)';
                            webViewStatus.className = 'ok';
                        } else {
                            webViewStatus.textContent = result.error + ' (async)';
                            webViewStatus.className = 'err';
                        }
                    });
                }
            }
        };

        function sendMessage(msg_id, with_webview) {
            if (!DemoApp.initDataUnsafe.query_id) {
                alert('WebViewQueryId not defined');
                return;
            }

            document.querySelectorAll('button').forEach((btn) => btn.disabled = true);

            const btn = document.querySelector('#btn_status');
            btn.textContent = 'Sending...';

            DemoApp.apiRequest('sendMessage', {
                msg_id: msg_id || 'hello', // Change 'hello' to the desired message
                with_webview: !DemoApp.initDataUnsafe.receiver && with_webview ? 1 : 0
            }, function(result) {
                document.querySelectorAll('button').forEach((btn) => btn.disabled = false);

                if (result.response) {
                    if (result.response.ok) {
                        btn.textContent = 'Message sent successfully!';
                        btn.className = 'ok';
                    } else {
                        btn.textContent = result.response.description;
                        btn.className = 'err';
                        alert(result.response.description);
                    }
                } else if (result.error) {
                    btn.textContent = result.error;
                    btn.className = 'err';
                    alert(result.error);
                } else {
                    btn.textContent = 'Unknown error';
                    btn.className = 'err';
                    alert('Unknown error');
                }
            });
        }

        // Add a click event listener to the button
        document.getElementById('sendMessageButton').addEventListener('click', function() {
            sendMessage('hello', false); // Change 'hello' to the desired message
        });

        DemoApp.checkInitData(); // Call checkInitData when the page loads
    </script>
</body>
</html>
